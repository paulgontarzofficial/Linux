
DNS is a system that is used for resolving computer names to IP addresses, and it doesn't have a central database. 

There are several types of DNS servers that are used worldwide. 

| Server Type                  | Description                                                                                                                                                                                                                                    |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DNS Root Server              | Are responsible for the top-level domains (TLD). As the last instance, they are only requested if the name server does not respond.                                                                                                            |
| Authoritative Nameserver     | Hold authority for a particular zone. They only answer queries from their area of responsibility, and their information is binding. If an authoritative name server cannot resolve a name, then the root name server takes over at that point. |
| Non-Authoritative Nameserver | Not responsible for a particular DNS zone. Instead, they collect info on specific DNS zones themselves, which is done using recursive or iterative DNS querying.                                                                               |
| Caching DNS Server           | Caches information from other name servers for a specified period. The authoritative name server determines the duration of this storage.                                                                                                      |
| Forwarding Server            | Performs only one function: They forward DNS quesries to another DNS server.                                                                                                                                                                   |
| Resolver                     | Are not authoritative DNS servers but perform name resolution locally in the computer or router.                                                                                                                                               |
DNS is mainly unencrypted. Because of this security fault, IT security professionals have developed DNS over TLS (DoT) or DNS over HTTPS (DoH). 

There also is a network protocol called DNSCrypt that also encrypts the traffic between the computer and the name server. 

DNS doesn't just store name information, it also stores and outputs information about the services associated with the domain. 

Different DNS records are used for different queries. 

A = Returns an IPv4 Address of the requested domain as a result 
AAAA = Returns an IPv6 address of the requested domain
MX = Returns the responsible mail servers as a result 
NS = Returns the DNS servers (nameservers) of the domain
TXT = This record can contain various information such as validating Google Search Console, or validate SSL certificates. In addition, SPF and DMARC entries are set to validate mail traffic.
CNAME = This record serves as a alias for another domain name. For example if we want to access www.hackthebox.eu and we have an A record for hackthebox.eu, we can create a CNAME for www.hackthebox.eu. 
PTR = These records work in reverse, it converts an IP Address into a valid domain name. 
SOA = Provides information about the corresponding DNS zone and email address of the administrative contact. 

Default Configurations

There are three main types of configuration files that we can look at: 
	- Local DNS configuration files 
	- Zone Files
	- Reverse Name Resolution Files 

The DNS Server Bind9 is commonly used within Linux distros. Some local configuration files are as follows: 
	- named.conf.local
	- named.conf.options
	- named.conf.log

root@bind9:~# cat /etc/bind/named.conf.local

//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your
// organization
//include "/etc/bind/zones.rfc1918";
zone "domain.com" {
    type master;
    file "/etc/bind/db.domain.com";
    allow-update { key rndc-key; };
};

A zone file is a text file that describes a DNS zone with the BIND file format. Think of it like a point of delegtation in the DNS tree. The BIND file format is the industry preferred format and is well established in DNS server software. 

Forward records are entered using the BIND format. This allows the DNS server to identify which domain, hostname, and role of IP addresses belong to. Simple terms, think of it like a phone book and DNS server looks up the addresses the domain searches for. 

For the IP address to be resolved from the FQDN, the DNS server must have a reverse lookup file. 

Reverse Name Resolution Zone Files
  DNS
root@bind9:~# cat /etc/bind/db.10.129.14

;
; BIND reverse data file for local loopback interface
;
$ORIGIN 14.129.10.in-addr.arpa
$TTL 86400
@     IN     SOA    dns1.domain.com.     hostmaster.domain.com. (
                    2001062501 ; serial
                    21600      ; refresh after 6 hours
                    3600       ; retry after 1 hour
                    604800     ; expire after 1 week
                    86400 )    ; minimum TTL of 1 day

      IN     NS     ns1.domain.com.
      IN     NS     ns2.domain.com.

5    IN     PTR    server1.domain.com.
7    IN     MX     mx.domain.com.
...SNIP...

Dangerous Settings 

https://securitytrails.com/blog/most-popular-types-dns-attacks

Some settings that are listed below can lead to targets being vulnerable if left unpatched. In most cases, functionality has a higher priority over security which leads to misconfigurations and vulnerabilities. 

allow-query = Defines which hosts are allowed to send requests to the DNS server
allow-recursion = Defines which host is allowed to send recursive requests to the DNS sever. 
allow-transfer = Defines which hosts are allowed to recieve zone transfers from the DNS server 
zone-statistics = Collects statistical data of zones. 

Footprinting the Service

Footprinting DNS is done by sending requests to the server. We can do this by utilizing the NS record and the specification of the DNS server we want to query using the @ character. 

realCustampin@htb[/htb]$ dig ns inlanefreight.htb @10.129.14.128

; <<>> DiG 9.16.1-Ubuntu <<>> ns inlanefreight.htb @10.129.14.128
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 45010
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: ce4d8681b32abaea0100000061475f73842c401c391690c7 (good)
;; QUESTION SECTION:
;inlanefreight.htb.             IN      NS

;; ANSWER SECTION:
inlanefreight.htb.      604800  IN      NS      ns.inlanefreight.htb.

;; ADDITIONAL SECTION:
ns.inlanefreight.htb.   604800  IN      A       10.129.34.136

;; Query time: 0 msec
;; SERVER: 10.129.14.128#53(10.129.14.128)
;; WHEN: So Sep 19 18:04:03 CEST 2021
;; MSG SIZE  rcvd: 107

Sometimes we are able to query the version utilizing the CHAOS class query and type TXT. In order for us to do that though, the entry must be entered on the DNS server. 

realCustampin@htb[/htb]$ dig CH TXT version.bind 10.129.120.85

; <<>> DiG 9.10.6 <<>> CH TXT version.bind
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 47786
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; ANSWER SECTION:
version.bind.       0       CH      TXT     "9.10.6-P1"

;; ADDITIONAL SECTION:
version.bind.       0       CH      TXT     "9.10.6-P1-Debian"

;; Query time: 2 msec
;; SERVER: 10.129.120.85#53(10.129.120.85)
;; WHEN: Wed Jan 05 20:23:14 UTC 2023
;; MSG SIZE  rcvd: 101

We can also use the option ANY to view all available records. 

realCustampin@htb[/htb]$ dig any inlanefreight.htb @10.129.14.128

; <<>> DiG 9.16.1-Ubuntu <<>> any inlanefreight.htb @10.129.14.128
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 7649
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 064b7e1f091b95120100000061476865a6026d01f87d10ca (good)
;; QUESTION SECTION:
;inlanefreight.htb.             IN      ANY

;; ANSWER SECTION:
inlanefreight.htb.      604800  IN      TXT     "v=spf1 include:mailgun.org include:_spf.google.com include:spf.protection.outlook.com include:_spf.atlassian.net ip4:10.129.124.8 ip4:10.129.127.2 ip4:10.129.42.106 ~all"
inlanefreight.htb.      604800  IN      TXT     "atlassian-domain-verification=t1rKCy68JFszSdCKVpw64A1QksWdXuYFUeSXKU"
inlanefreight.htb.      604800  IN      TXT     "MS=ms97310371"
inlanefreight.htb.      604800  IN      SOA     inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
inlanefreight.htb.      604800  IN      NS      ns.inlanefreight.htb.

;; ADDITIONAL SECTION:
ns.inlanefreight.htb.   604800  IN      A       10.129.34.136

;; Query time: 0 msec
;; SERVER: 10.129.14.128#53(10.129.14.128)
;; WHEN: So Sep 19 18:42:13 CEST 2021
;; MSG SIZE  rcvd: 437

10.129.234.55

dnsenum --dnsserver 10.129.234.55 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb